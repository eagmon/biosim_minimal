"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.updateWorkspaceConfig = void 0;
const devkit_1 = require("@nrwl/devkit");
const version_utils_1 = require("../../utils/version-utils");
function updateWorkspaceConfig(tree, project) {
    var _a, _b;
    const installedAngularVersionInfo = (0, version_utils_1.getInstalledAngularVersionInfo)(tree);
    const projectConfig = (0, devkit_1.readProjectConfiguration)(tree, project);
    projectConfig.targets.test = {
        executor: '@angular-devkit/build-angular:karma',
        options: Object.assign(Object.assign({}, (installedAngularVersionInfo.major === 14
            ? { main: (0, devkit_1.joinPathFragments)(projectConfig.sourceRoot, 'test.ts') }
            : {})), { tsConfig: (0, devkit_1.joinPathFragments)(projectConfig.root, 'tsconfig.spec.json'), karmaConfig: (0, devkit_1.joinPathFragments)(projectConfig.root, 'karma.conf.js'), polyfills: ['zone.js', 'zone.js/testing'] }),
    };
    if (projectConfig.projectType === 'application') {
        const polyfills = (_b = (_a = projectConfig.targets.build) === null || _a === void 0 ? void 0 : _a.options) === null || _b === void 0 ? void 0 : _b.polyfills;
        let polyfillsPath = polyfills && typeof polyfills === 'string' ? polyfills : undefined;
        projectConfig.targets.test.options = Object.assign(Object.assign({}, projectConfig.targets.test.options), { polyfills: polyfillsPath !== null && polyfillsPath !== void 0 ? polyfillsPath : projectConfig.targets.test.options.polyfills, styles: [], scripts: [], assets: [] });
    }
    if (projectConfig.targets.lint &&
        projectConfig.targets.lint.executor ===
            '@angular-devkit/build-angular:tslint') {
        projectConfig.targets.lint.options.tsConfig = [
            ...projectConfig.targets.lint.options.tsConfig,
            (0, devkit_1.joinPathFragments)(projectConfig.root, 'tsconfig.spec.json'),
        ];
    }
    (0, devkit_1.updateProjectConfiguration)(tree, project, projectConfig);
}
exports.updateWorkspaceConfig = updateWorkspaceConfig;
//# sourceMappingURL=update-workspace-config.js.map